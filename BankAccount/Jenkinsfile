pipeline {
  agent any
  options { timestamps() }
  environment { VENV = ".venv" }

  stages {
    stage('Checkout') {
      steps { checkout scm }
    }

    stage('Setup Python') {
      steps {
        sh '''
          python3 -V
          python3 -m venv $VENV || true
          . $VENV/bin/activate
          if [ -f BankAccount/requirements.txt ]; then pip install -r BankAccount/requirements.txt; fi
        '''
      }
    }

    stage('Run script') {
      steps {
        sh '''
          . $VENV/bin/activate || true
          python3 BankAccount/BankAccount.py | tee BankAccount/run.log
        '''
      }
    }

    stage('Archive output') {
      steps { archiveArtifacts artifacts: 'BankAccount/run.log', onlyIfSuccessful: false }
    }
  }

  post { always { cleanWs() } }
}
